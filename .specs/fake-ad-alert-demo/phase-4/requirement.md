# 要件定義書 - FakeAdAlertDemo Phase 4: サイドパネル化

## 1. 概要

### 1.1 フェーズ目的

VC検証情報の表示をポップアップからChrome Side Panelに移行し、SNSページ閲覧中に常時表示される営業デモ体験を実現する。DeepL翻訳拡張のようにブラウザ右側に固定表示され、ページ遷移しても閉じないUIを提供する。

### 1.2 スコープ

| 対象 | 内容 |
|------|------|
| 含む | ポップアップUIのサイドパネル移行、リアルタイム更新、manifest.json変更 |
| 含まない | 新規SNS対応、新規検証項目追加、UI/カードデザインの変更 |

### 1.3 完了条件

- ツールバーアイコンクリックでサイドパネルが開く
- サイドパネルがページ遷移しても開いたままになる
- 広告検出時にサイドパネルの表示がリアルタイムに更新される
- Phase 3のポップアップと同等の情報（4カード構成）が表示される
- Instagram/TikTok での既存バッジ・オーバーレイ機能にデグレなし

### 1.4 前提条件

- Phase 0〜3が完了していること
- Chrome 114以上（Side Panel API対応）
- 既存のVC型定義（vc-types.ts）、モックVC情報（vc-mock.ts）をそのまま再利用

---

## 2. 機能要件

### 2.1 サイドパネル表示

**[REQ-P4-001] サイドパネル基本動作**
- ツールバーアイコンクリックでサイドパネルを開閉する
- サイドパネルはブラウザ右側に固定表示される
- タブ切り替え・ページ遷移してもサイドパネルは開いたままになる
- サイドパネルの幅はユーザーがドラッグでリサイズ可能（Chrome標準機能）

**[REQ-P4-002] サイドパネルUIレイアウト**
- Phase 3のポップアップと同じダークテーマ + グラスモーフィズムデザインを継承する
- 同じ4カード構成（広告情報、検証ステータス、信頼チェーン、ブロックチェーン証明）を表示する
- ヘッダー、ステータスバッジ、対応SNSタグ、フッターを含む
- サイドパネルは縦長のため、ポップアップの `width: 360px` 制約がなくなりレイアウトに余裕が生まれる

### 2.2 リアルタイム更新

**[REQ-P4-003] 検出情報のリアルタイム反映**
- Content Scriptが広告を検出したら、サイドパネルの表示が自動更新される
- ポップアップのように「開き直す」操作は不要
- chrome.storage.session の変更を監視（`chrome.storage.onChanged`）してUIを更新する

**[REQ-P4-004] 検出履歴の表示（直近1件）**
- 直近に検出した広告の情報を表示する（Phase 3と同じ）
- 新しい広告が検出されるたびに上書き更新される

### 2.3 ポップアップの廃止

**[REQ-P4-005] ポップアップからサイドパネルへの完全移行**
- manifest.json の `action.default_popup` を削除する
- ツールバーアイコンクリック時はサイドパネルを開く動作に変更する
- ポップアップ用ファイル（src/popup/）はサイドパネル用ファイル（src/sidepanel/）に移行する

---

## 3. 非機能要件

**[NFR-P4-001] 表示速度**
- サイドパネルは即座（500ms以内）に表示される

**[NFR-P4-002] リアルタイム更新の即時性**
- 広告検出からサイドパネル更新まで500ms以内

**[NFR-P4-003] デザイン一貫性**
- Phase 3のダークテーマ + グラスモーフィズムをそのまま維持する
- share-verifierとの統一性を保持する

**[NFR-P4-004] パフォーマンス**
- サイドパネル常時表示でもブラウザの動作に影響を与えない
- メモリ使用量の増加は最小限に抑える

---

## 4. 制約事項

**[CON-P4-001] Chrome バージョン要件**
- Side Panel API は Chrome 114+ / Manifest V3 が必須
- 古いChromeバージョンでは動作しない（営業デモ用なので問題なし）

**[CON-P4-002] 既存UI資産の再利用**
- CSS/TS のUI生成ロジックはPhase 3のものを最大限再利用する
- 新規デザイン作成は行わない

---

## 5. UI仕様

### 5.1 サイドパネルレイアウト（認証済み）

```
┌─ Side Panel ─────────────────────┐
│                                   │
│  🔰 FakeAdAlertDemo              │ ← ダークテーマ (#0f0f23)
│  VC Ad Verifier                   │
│  ─────────────────────────────   │
│  ✅ 拡張機能は有効               │
│  📸 Instagram ✓  🎵 TikTok ✓    │
│  ─────────────────────────────   │
│                                   │
│  ✅ 検証完了 - 証明書は有効です   │
│                                   │
│  ▼ 📋 広告情報                   │ ← 展開可能カード
│    広告主: ソニーグループ株式会社  │
│    広告主DID: did:web:sony.co.jp │
│    カテゴリ: 電子機器・エンタメ   │
│    プラットフォーム: Instagram     │
│                                   │
│  ▶ ✓ 検証ステータス              │
│  ▶ 🔗 信頼チェーン              │
│  ▶ ⛓️ ブロックチェーン証明       │
│                                   │
│  ─────────────────────────────   │
│  ⚠️ これはデモ用アプリです       │
└───────────────────────────────────┘
```

### 5.2 ポップアップとの比較

| 項目 | ポップアップ（Phase 3） | サイドパネル（Phase 4） |
|------|----------------------|----------------------|
| 表示トリガー | アイコンクリック | アイコンクリック |
| 表示位置 | アイコン直下の小窓 | ブラウザ右側固定 |
| 幅 | 360px固定 | 可変（ユーザーリサイズ可） |
| ページ遷移時 | 閉じる | 開いたまま |
| 情報更新 | 開き直し必要 | リアルタイム自動更新 |
| デザイン | ダークテーマ + グラスモーフィズム | 同じ（継承） |
| 表示内容 | 4カード構成 | 同じ（継承） |

### 5.3 カラースキーム

Phase 3と同一。変更なし。

| 要素 | 色 | 用途 |
|------|-----|------|
| Background | #0f0f23 | サイドパネル背景 |
| Card BG | rgba(255,255,255,0.06) | グラスモーフィズムカード |
| Card Border | rgba(255,255,255,0.12) | カード境界線 |
| Primary | #0ea5e9 | VeriCertsブランド、アクセント |
| Accent Cyan | #00d4ff | DID/コード表示 |
| Success | #10b981 / #4ade80 | 認証済み、✓マーク |
| Danger | #ef4444 / #f87171 | フェイク、✗マーク |
| Text Primary | #ffffff | メインテキスト |
| Text Muted | rgba(255,255,255,0.6) | サブテキスト、ラベル |
