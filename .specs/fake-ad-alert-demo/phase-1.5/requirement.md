# 要件定義書 - FakeAdAlertDemo Phase 1.5: Instagram デモモード対応

## 1. 概要

### 1.1 フェーズ目的

営業デモを効果的に行うため、Instagramのホームフィード・プロフィールページ・個別投稿すべてでバッジ/警告が表示されるデモモードを実装する。

### 1.2 背景

Phase 1では「広告」ラベル付きの投稿のみを検出対象としていたが、営業デモにおいて以下の課題がある：
- 広告はランダムに表示されるため、デモ中に広告が出るとは限らない
- 「広告が出るまでスクロールしてください」ではデモとして不十分

### 1.3 デモシナリオ

1. デモ用Instagramアカウントを作成
2. ホワイトリスト企業（nike, uniqlo, toyota_jp等）をフォロー
3. 怪しいアカウント（詐欺系、なりすまし系）をフォロー
4. ホームフィードをスクロール → 認証バッジと警告が混在して表示
5. 各アカウントをクリック → プロフィール/個別投稿でもバッジ表示

### 1.4 スコープ

| 対象 | 内容 |
|------|------|
| 含む | デモモード、プロフィールページ対応、個別投稿モーダル対応 |
| 含まない | TikTok対応（Phase 2）、ポップアップUI（Phase 3） |

### 1.5 完了条件

- ホームフィードの通常投稿にバッジ/警告が表示される
- プロフィールページのグリッド表示にバッジ/警告が表示される
- 個別投稿モーダルにバッジ/警告が表示される
- ホワイトリスト/ブラックリストに基づいた判定が動作する

### 1.6 前提条件

Phase 1が完了していること（広告検出・判定ロジックが実装済み）。

---

## 2. 機能要件

### 2.1 デモモード

**[REQ-P1.5-001] 全投稿の検出（デモモード）**
- 「広告」ラベルの有無に関わらず、すべての投稿を検出対象とする
- 投稿者のアカウント名で判定を行う
- MutationObserverによる動的検出は既存ロジックを流用

**[REQ-P1.5-002] アカウント名ベースの判定**
- 投稿者のアカウント名（ユーザー名）で判定を行う
- URLからアカウント名を取得する機能を追加（プロフィールページ用）
- 既存のホワイトリスト/ブラックリスト判定ロジックを流用

### 2.2 プロフィールページ対応

**[REQ-P1.5-003] プロフィールページの検出**
- `instagram.com/{username}/` 形式のURLを検出
- URLからアカウント名を取得
- ページ遷移（SPAナビゲーション）を検出する

**[REQ-P1.5-004] プロフィールヘッダーへのバッジ表示**
- プロフィールページのヘッダー部分（アカウント名横）にバッジを表示
- 認証済みアカウント → 認証バッジ
- 未認証/ブラックリストアカウント → 警告バッジ

**[REQ-P1.5-005] グリッド表示への対応**
- プロフィールページの投稿グリッド（サムネイル一覧）にオーバーレイを表示
- 各サムネイルの上に半透明のバッジ/警告アイコンを表示
- アカウント単位で判定（個別投稿の内容は見ない）

### 2.3 個別投稿モーダル対応

**[REQ-P1.5-006] 個別投稿モーダルの検出**
- グリッドからクリックして開いたモーダルを検出
- モーダル内の投稿者名を取得
- モーダルの開閉を監視

**[REQ-P1.5-007] モーダル内のバッジ/警告表示**
- モーダル内のヘッダー（投稿者名横）にバッジを表示
- モーダル内の画像/動画上に警告オーバーレイを表示（未認証の場合）

### 2.4 既存機能との統合

**[REQ-P1.5-008] ホームフィードでの動作（デモモード）**
- 既存のホームフィード検出ロジックを拡張
- 「広告」ラベルがない通常投稿も検出対象に
- 投稿者のアカウント名で判定

**[REQ-P1.5-009] 判定ロジックの共通化**
- プロフィール/モーダル/フィードで同一の判定ロジックを使用
- ホワイトリスト → 認証バッジ
- ブラックリスト/未登録 → 警告表示

---

## 3. 非機能要件

**[NFR-P1.5-001] パフォーマンス**
- プロフィールページのグリッド表示でもスムーズに動作
- 大量のサムネイル（数十件）にも対応
- バッジ表示は1秒以内

**[NFR-P1.5-002] SPA対応**
- InstagramはSPA（Single Page Application）のため、ページ遷移を適切に検出
- URL変更時に再スキャンを実行
- popstate / pushState を監視

**[NFR-P1.5-003] デモ安定性**
- デモ中に確実に動作すること
- Instagram側のDOM構造変更に備えた堅牢な実装
- エラー時もページ全体に影響を与えない

---

## 4. 制約事項

**[CON-P1.5-001] デモ専用機能**
- デモモードは営業デモ専用
- 通常ユーザーが使用する想定ではない

**[CON-P1.5-002] InstagramのDOM依存**
- プロフィールページ/モーダルのDOM構造に依存
- Instagram側の変更で動作しなくなる可能性
- デモ前に必ず動作確認を行う

**[CON-P1.5-003] グリッド表示の制限**
- サムネイル上のオーバーレイは視認性を損なわない範囲に
- 小さいアイコン/バッジで表現

---

## 5. 前提条件

**[ASM-P1.5-001] Phase 1完了**
- 広告検出・判定ロジックが実装済み
- ホワイトリスト/ブラックリスト設定が存在

**[ASM-P1.5-002] デモ用アカウント**
- デモ実施者がデモ用Instagramアカウントを作成
- ホワイトリスト/ブラックリスト企業をフォロー済み

---

## 6. 用語集

| 用語 | 定義 |
|------|------|
| デモモード | 広告以外の通常投稿もバッジ表示対象とするモード |
| グリッド表示 | プロフィールページの投稿サムネイル一覧 |
| 個別投稿モーダル | サムネイルをクリックして開くオーバーレイ表示 |
| SPA | Single Page Application - ページ遷移なしに画面が切り替わるアプリ |

---

## 7. UI仕様（参考）

### 7.1 プロフィールヘッダー

```
┌─────────────────────────────────────────────┐
│  [アイコン]  nike ✅ VeriCerts認証済み       │
│  投稿100件  フォロワー1000万人               │
│  [フォロー] [メッセージ]                     │
└─────────────────────────────────────────────┘
```

### 7.2 グリッド表示（認証済み）

```
┌─────┐ ┌─────┐ ┌─────┐
│ [✅]│ │ [✅]│ │ [✅]│  ← 小さい認証アイコン
│     │ │     │ │     │
└─────┘ └─────┘ └─────┘
```

### 7.3 グリッド表示（警告）

```
┌─────┐ ┌─────┐ ┌─────┐
│ [⚠️]│ │ [⚠️]│ │ [⚠️]│  ← 小さい警告アイコン
│     │ │     │ │     │
└─────┘ └─────┘ └─────┘
```

### 7.4 個別投稿モーダル

```
┌───────────────────────────────────────┐
│ ┌─────────────────────────────────┐   │
│ │ [アイコン] 詐欺アカウント ⚠️     │   │
│ ├─────────────────────────────────┤   │
│ │                                 │   │
│ │  ┌─────────────────────────┐   │   │
│ │  │  ⚠️ 未認証アカウント     │   │   │
│ │  │   注意が必要です        │   │   │
│ │  └─────────────────────────┘   │   │
│ │                                 │   │
│ └─────────────────────────────────┘   │
│                              [×]      │
└───────────────────────────────────────┘
```
