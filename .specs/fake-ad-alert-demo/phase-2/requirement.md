# 要件定義書 - FakeAdAlertDemo Phase 2: TikTok対応

## 1. 概要

### 1.1 フェーズ目的

TikTokフィード上の広告を自動検出し、Phase 1で実装した判定ロジックを活用してフェイク/認証済みの判定結果を表示する。

### 1.2 スコープ

| 対象 | 内容 |
|------|------|
| 含む | TikTok広告検出、TikTok用UI調整 |
| 含まない | 判定ロジック（Phase 1で実装済み）、YouTube対応（Phase 4） |
| 流用 | verifier.ts, config-loader.ts, ad-verification.yml, types.ts |

### 1.3 完了条件

TikTokでフェイク広告に警告オーバーレイ、認証済み広告に認証バッジが表示されること。

### 1.4 前提条件

- Phase 0が完了していること（Chrome拡張の基盤が構築済み）
- Phase 1が完了していること（判定ロジック・共通コンポーネントが実装済み）

---

## 2. 機能要件

### 2.1 広告検出機能

**[REQ-P2-001] TikTok広告要素の検出**
- TikTokフィード（For You / Following）上の広告を自動検出する
- 広告を示す「広告」「Sponsored」「プロモーション」ラベルをDOM上で検出する
- 縦スクロールのショート動画フィードに対応する

**[REQ-P2-002] 動的コンテンツの監視**
- MutationObserverでDOM変更を監視する
- スワイプ/スクロール時に動的に読み込まれる広告も検出する
- パフォーマンスに配慮した効率的な監視を行う

**[REQ-P2-003] 広告主名の取得**
- 検出した広告から広告主名（アカウント名）を取得する
- 動画投稿のオーバーレイ部分からユーザー名を抽出する

### 2.2 UI表示機能

**[REQ-P2-004] 警告オーバーレイ表示**
- フェイク/未検証の広告に警告オーバーレイを表示する
- TikTokの縦型動画UIに適したオーバーレイ配置
- 動画の視認性を考慮した半透明デザイン

**[REQ-P2-005] 認証バッジ表示**
- 認証済み広告に認証バッジを表示する
- 広告主名の近くにバッジを表示する
- TikTokのUIに合わせたデザイン

**[REQ-P2-006] TikTokデザインとの調和**
- TikTokのダークテーマに合わせたUI
- 縦型フルスクリーン動画に適した配置
- 右サイドのアクションボタンと干渉しない位置

**[REQ-P2-007] 重複表示の防止**
- 同じ広告に複数回オーバーレイ/バッジを表示しない
- 処理済みの広告要素をマーキングして管理する

### 2.3 マニフェスト更新

**[REQ-P2-008] TikTok用Content Script登録**
- manifest.jsonにTikTok用Content Scriptを追加する
- TikTok用CSSを登録する

---

## 3. 非機能要件

**[NFR-P2-001] パフォーマンス**
- 広告検出処理は動画再生を妨げない
- MutationObserverは必要最小限の監視に留める

**[NFR-P2-002] ユーザビリティ**
- 警告/認証表示は動画スワイプ時に即座に表示される
- UIは動画の操作（いいね、コメント等）を妨げない

**[NFR-P2-003] 保守性**
- TikTokのDOM構造変更に対応しやすい設計
- Instagram用コードと共通部分を適切に分離

---

## 4. 制約事項

**[CON-P2-001] TikTokのDOM依存**
- TikTokのDOM構造に依存するため、TikTok側の変更で動作しなくなる可能性がある
- デモ前に必ず動作確認を行う

**[CON-P2-002] 縦型動画UI**
- フルスクリーン縦型動画のため、オーバーレイの配置に注意が必要
- 動画コントロールやアクションボタンと干渉しないこと

---

## 5. 前提条件

**[ASM-P2-001] Phase 1完了**
- 判定ロジック（verifier.ts）が実装済み
- 設定ファイル（ad-verification.yml）が存在する
- 共通型定義（types.ts）が存在する

**[ASM-P2-002] TikTokへのアクセス**
- デモ実施者はTikTokにアクセス可能
- フィードに広告が表示される状態

---

## 6. 用語集

| 用語 | 定義 |
|------|------|
| For You | TikTokのおすすめフィード |
| Following | TikTokのフォロー中フィード |
| プロモーション | TikTokの広告ラベルの一種 |

---

## 7. UI仕様（参考）

### 7.1 警告オーバーレイ（TikTok）

```
┌─────────────────────────────┐
│                             │
│    [縦型動画]               │
│                             │
│    ┌───────────────────┐    │
│    │  ⚠️ 未認証広告     │    │  ← 中央に半透明オーバーレイ
│    │   詐欺の可能性     │    │
│    └───────────────────┘    │
│                             │
│ @advertiser ← 広告主名      │  ❤️
│ 広告                        │  💬
│ #hashtag #ad               │  ↗️
└─────────────────────────────┘
```

### 7.2 認証バッジ（TikTok）

```
┌─────────────────────────────┐
│                             │
│    [縦型動画]               │  ← オーバーレイなし
│                             │
│                             │
│                             │
│                             │
│ @advertiser ✅ VeriCerts    │  ❤️  ← 認証バッジ
│ 広告                        │  💬
│ #hashtag #ad               │  ↗️
└─────────────────────────────┘
```
