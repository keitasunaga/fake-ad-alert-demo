# 要件定義書 - FakeAdAlertDemo Phase 1: Instagram対応（MVP）

## 1. 概要

### 1.1 フェーズ目的

Instagramフィード上の広告を自動検出し、フェイク/認証済みの判定結果を視覚的に表示するMVPを完成させる。

### 1.2 スコープ

| 対象 | 内容 |
|------|------|
| 含む | Instagram広告検出、判定ロジック、警告/認証UI、設定ファイル |
| 含まない | TikTok対応（Phase 2）、YouTube対応（Phase 4）、ポップアップUI（Phase 3） |

### 1.3 完了条件

Instagramでフェイク広告に警告オーバーレイ、認証済み広告に認証バッジが表示されること。

### 1.4 前提条件

Phase 0が完了していること（Chrome拡張の基盤が構築済み）。

---

## 2. 機能要件

### 2.1 広告検出機能

**[REQ-P1-001] Instagram広告要素の検出**
- Instagramフィード上の広告（Sponsored投稿）を自動検出する
- 広告を示す「広告」「Sponsored」ラベルをDOM上で検出する
- フィード一覧と個別投稿の両方で検出する

**[REQ-P1-002] 動的コンテンツの監視**
- MutationObserverでDOM変更を監視する
- スクロール時に動的に読み込まれる広告も検出する
- パフォーマンスに配慮した効率的な監視を行う

**[REQ-P1-003] 広告主名の取得**
- 検出した広告から広告主名（アカウント名）を取得する
- 広告投稿のヘッダー部分からユーザー名を抽出する

### 2.2 判定機能

**[REQ-P1-004] 設定ファイルの読み込み**
- YAML形式の設定ファイルから広告主リストを読み込む
- ホワイトリスト（認証済み）とブラックリスト（フェイク）を定義する
- 各広告主に対してパターン（文字列マッチ）を設定可能にする

**[REQ-P1-005] ホワイトリスト判定**
- 広告主名がホワイトリストのパターンにマッチするか判定する
- マッチした場合は「VC認証済み」として扱う

**[REQ-P1-006] ブラックリスト判定**
- 広告主名がブラックリストのパターンにマッチするか判定する
- マッチした場合は「フェイク広告」として扱う

**[REQ-P1-007] デフォルト判定**
- ホワイトリスト/ブラックリストどちらにもマッチしない場合
- 「未検証」として警告表示する（フェイクと同様の扱い）

### 2.3 UI表示機能

**[REQ-P1-008] 警告オーバーレイ表示**
- フェイク/未検証の広告に警告オーバーレイを表示する
- 広告画像/動画上に半透明のオーバーレイを被せる
- ⚠️ アイコンと警告テキストを表示する
- 赤系の配色で危険性を視覚的に伝える

**[REQ-P1-009] 認証バッジ表示**
- 認証済み広告に認証バッジを表示する
- 広告主名の近くに ✅ バッジを表示する
- 「VeriCerts認証済み」のテキストを表示する
- 緑または青系の配色で安心感を伝える

**[REQ-P1-010] Instagramデザインとの調和**
- Instagramのデザイン言語に合わせた自然なUIとする
- フォント、角丸、シャドウなどをInstagramに寄せる
- ぱっと見でフェイクか認証済みかが分かるデザインとする

**[REQ-P1-011] 重複表示の防止**
- 同じ広告に複数回オーバーレイ/バッジを表示しない
- 処理済みの広告要素をマーキングして管理する

### 2.4 設定・データ管理

**[REQ-P1-012] 広告主リスト設定ファイル**
- config/ad-verification.yml として配置する
- ホワイトリストとブラックリストを分けて定義する
- 広告主名とパターン（複数可）を設定可能にする

---

## 3. 非機能要件

**[NFR-P1-001] パフォーマンス**
- 広告検出・判定処理はページ表示を遅延させない
- MutationObserverは必要最小限のDOM監視に留める
- 判定処理は非同期で実行する

**[NFR-P1-002] ユーザビリティ**
- 警告/認証表示は即座に（1秒以内に）表示される
- UIはInstagramの操作を妨げない
- オーバーレイは広告の視認性を著しく損なわない程度の透過度

**[NFR-P1-003] 保守性**
- InstagramのDOM構造変更に対応しやすい設計
- セレクタは設定ファイルまたは定数として管理
- 広告検出ロジックとUI表示ロジックを分離

---

## 4. 制約事項

**[CON-P1-001] InstagramのDOM依存**
- InstagramのDOM構造に依存するため、Instagram側の変更で動作しなくなる可能性がある
- デモ前に必ず動作確認を行う

**[CON-P1-002] モック判定**
- 実際のVC検証は行わない
- 広告主名のパターンマッチによるモック判定とする

**[CON-P1-003] デモ用設定**
- ホワイトリスト/ブラックリストはデモ用のサンプルデータとする
- 実在の企業名を使用する場合は営業デモの文脈で適切に扱う

---

## 5. 前提条件

**[ASM-P1-001] Phase 0完了**
- Chrome拡張の基盤が構築済み
- Content Script（instagram.ts）が動作している

**[ASM-P1-002] Instagramへのアクセス**
- デモ実施者はInstagramにログイン可能
- フィードに広告が表示される状態

**[ASM-P1-003] 技術スタック**
- TypeScript
- CSS（Instagramに注入）
- YAML（設定ファイル）

---

## 6. 用語集

| 用語 | 定義 |
|------|------|
| Sponsored | Instagramの広告ラベル（日本語環境では「広告」） |
| MutationObserver | DOMの変更を監視するWeb API |
| オーバーレイ | 既存の要素の上に被せて表示するUI要素 |
| パターンマッチ | 文字列が特定のパターンに一致するか判定する処理 |

---

## 7. UI仕様（参考）

### 7.1 警告オーバーレイ

```
┌─────────────────────────────┐
│ [広告主アイコン] 広告主名    │
│ 広告 ・ Sponsored           │
├─────────────────────────────┤
│                             │
│    [広告画像/動画]          │
│    ┌───────────────────┐    │
│    │  ⚠️ 未認証広告     │    │  ← 赤系半透明オーバーレイ
│    │   詐欺の可能性     │    │
│    │                   │    │
│    └───────────────────┘    │
│                             │
└─────────────────────────────┘
```

### 7.2 認証バッジ

```
┌─────────────────────────────┐
│ [広告主アイコン] 広告主名 ✅ │  ← 緑/青バッジ
│ 広告 ・ VeriCerts認証済み   │  ← テキスト置換または追加
├─────────────────────────────┤
│                             │
│    [広告画像/動画]          │  ← オーバーレイなし
│                             │
└─────────────────────────────┘
```
